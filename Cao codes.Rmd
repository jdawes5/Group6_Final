---
title: 'Group 6 Final Project: Codes and Technical Analysis'
author: "Junran Cao, Jordan Dawes, and Carter Rogers"
output: html_document:
    code_folding: hide
    number_sections: true
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=F}
library(dplyr)

library(ezids)

```

```{r setup, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
# knitr::opts_chunk$set(include = F)
# knitr::opts_chunk$set(echo = TRUE)
options(scientific=T, digits = 3, scipen = 999) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```

Junran Cao - Analysis - Severity of the accident and road conditions

```{R}
df=dataset
```
Preprocessing and cleaning
```{r}
df=subset(df,select=c(Severity, Amenity,Bump, Crossing,Give_Way, Junction, No_Exit, Railway, Roundabout,Station, Stop, Traffic_Calming, Traffic_Signal, Turning_Loop))
str(df)
df=as.data.frame(df)
df$Amenity = factor(df$Amenity)
df$Bump=factor(df$Bump)
df$Crossing=factor(df$Crossing)
df$Give_Way=factor(df$Give_Way)
df$Junction=factor(df$Junction)
df$No_Exit=factor(df$No_Exit)
df$Railway=factor(df$Railway)
df$Roundabout=factor(df$Roundabout)
df$Station=factor(df$Station)
df$Stop=factor(df$Stop)
df$Traffic_Calming=factor(df$Traffic_Calming)
df$Traffic_Signal=factor(df$Traffic_Signal)
df$Turning_Loop=factor(df$Turning_Loop)
df$Severity=as.factor(df$Severity)
head(df)
```

Note: After reviewing the structure of the data set, we found out that "Turning_Loop" only had one level, meaning that the values of it were all "False".Therefore, we excluded it from our analysis for now. 

Analysis - Logistic Regression

```{r}
loadPkg("MASS")
dfLogit <- polr(Severity ~ Amenity+Bump+Crossing+Give_Way+Junction+No_Exit+Railway+Roundabout+Station+Stop+Traffic_Calming+Traffic_Signal, data = df, Hess = "TRUE")
dfLogit
summary(dfLogit)
(ctable <- coef(summary(dfLogit)))
p <- pnorm(abs(ctable[, "t value"]), lower.tail = FALSE) * 2
(ctable <- cbind(ctable, "p value" = p))
xkabledply( confint.default(dfLogit), title = "CIs using standard errors" )
expcoeff = exp(coef(dfLogit))
xkabledply( as.table(expcoeff), title = "Exponential of coefficients in Logit Reg" )
```

"Traffic_calming", "Stop", "Give-way",and "Railway" were not significant (P-value greater than 0.05)

If the 95% CI does not cross 0, the parameter estimate can be statistically significant.Therefore, "Bump", "Round_about", "Traffic_Signal", "Station", and "Traffic_Calming" were not statistically significant.

Interpretation:

When there was an amenity, the odds of the accident being more severe (i.e.,4, 3,2 versus 1) was 1.084 times that of the accidents which had no amenity, holding constant all other variables.

When there was a crossing, the odds of the accident being more severe (i.e.,4, 3,2 versus 1) was 1.224 times that of the accidents which had no crossing, holding constant all other variables.

When there was a junction, the odds of the accident being more severe (i.e.,4, 3,2 versus 1) was 2.767 times that of the accidents which had no junction, holding constant all other variables.


When there was traffic-signal, the odds of the accident being more severe (i.e.,4, 3,2 versus 1) was 2.061 times that of the accidents which had no traffic-signal, holding constant all other variables.

Model Evaluation

```{r}
loadPkg("pscl") # use pR2( ) function to calculate McFadden statistics for model eval
admitLogitpr2 = pR2(dfLogit)
admitLogitpr2
unloadPkg("pscl") 
```
According to the McFadden statistics, only 1.36% of the variations in y is explained by the explanatory variables in the model. This result urged us to look at other variables.

